---
title: "Accessing CORD19-NEKG dataset in R"
output: html_notebook
---

This notebook demonstartes how to access and query *CORD-19 Named Entities Knowledge Graph (CORD19-NEKG)* RDF dataset.

The dataset describes named entities identified in the scholarly articles of the [COVID-19 Open Research Dataset (CORD-19)](https://pages.semanticscholar.org/coronavirus-research) [1], a resource of over 47,000 articles about COVID-19 and the coronavirus family of viruses.

CORD19-NEKG is an initiative of the WIMMICS team, I3S laboratory, Université Côte d'Azur, CNRS, Inria. RDF files are generated using Morph-xR2RML, an implementation of the xR2RML mapping language [2].


#### Cite this work
When including CORD19-NEKG data in a publication or redistribution, please cite the dataset as follows:

R. Gazzotti, F. Michel, F. Gandon. CORD-19 Named Entities Knowledge Graph (CORD19-NEKG). University Côte d'Azur, Inria, CNRS. 2020. Retrieved from https://github.com/Wimmics/cord19-nekg.

#### References
[1] COVID-19 Open Research Dataset (CORD-19). 2020. Version 2020-04-03. Retrieved from https://pages.semanticscholar.org/coronavirus-research. Accessed 2020-04-06. doi:10.5281/zenodo.3715505

[2] F. Michel, L. Djimenou, C. Faron-Zucker, and J. Montagnat. Translation of Relational and Non-Relational Databases into RDF with xR2RML. In Proceedings of the 11th International Confenrence on Web Information Systems and Technologies (WEBIST 2015), Lisbon, Portugal, 2015.

```{r}
library(SPARQL)
```

```{r}
endpoint <- "https://covid19.i3s.unice.fr/sparql"
options <- NULL
```

```{r}
prefix <- c('covid','<http://ns.inria.fr/covid19/>')

sparql_prefix <- "
PREFIX rdfs:   <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl:    <http://www.w3.org/2002/07/owl#>
PREFIX xsd:    <http://www.w3.org/2001/XMLSchema#>

PREFIX bibo:   <http://purl.org/ontology/bibo/> 
PREFIX dce:    <http://purl.org/dc/elements/1.1/>
PREFIX dct:    <http://purl.org/dc/terms/>
PREFIX fabio:  <http://purl.org/spar/fabio/>
PREFIX foaf:   <http://xmlns.com/foaf/0.1/>
PREFIX frbr:   <http://purl.org/vocab/frbr/core#>
PREFIX oa:     <http://www.w3.org/ns/oa#>
PREFIX prov:   <http://www.w3.org/ns/prov#>
PREFIX schema: <http://schema.org/>


PREFIX covid:   <http://ns.inria.fr/covid19/>
PREFIX covidpr: <http://ns.inria.fr/covid19/property/>
"

```

```{r}
query <- "
SELECT (group_concat(distinct ?name,\"; \") AS ?authors)
       ?title 
       (year(?date) as ?year)
       ?pub
       ?url

WHERE {
    graph <http://ns.inria.fr/covid19/graph/articles>
    {
        ?doc a ?t;
            dce:creator ?name;
            dct:title ?title;
            schema:publication ?pub;
            schema:url ?url;
            dct:abstract [ rdf:value ?abs ].

        optional { ?doc dct:issued ?date }
        filter contains(?abs, \"coronavirus\")
    }
} 
group by ?doc ?title ?date ?pub ?url
order by desc(?date)

"

query <- paste(sparql_prefix, query)
  
```

```{r}
res <- SPARQL(url= endpoint,
              query = query,
              ns=prefix,
              extra=NULL)$results
```


```{r fig.width = 12, fig.height = 5, fig.align = "center"}
barplot(sort(table(res$year)),
        col="pink",
        space=0.3,
        ylab="# of papers",
        sub="Number of papers that mention 'coronavirus' in their abstarcts per year",
        font.sub=4)
```

